<!-- Delete Modal -->
<div id="deleteModal" class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50">
  <div id="deleteModalContent" class="bg-white rounded-lg shadow-lg w-11/12 sm:w-1/3">
    <div class="flex items-center justify-between p-4 border-b">
      <h3 class="text-xl font-semibold text-gray-900">Delete Product</h3>
      <button onclick="hideDeleteModal()" class="text-gray-400 hover:bg-gray-200 rounded-lg p-1.5">âœ•</button>
    </div>
    <div class="p-6 text-center">
      <p class="text-gray-700 mb-6">Are you sure you want to delete this product?</p>
      <div class="flex justify-center gap-4">
        <button onclick="hideDeleteModal()" class="px-6 py-2 border border-gray-300 rounded-md hover:bg-gray-50">Cancel</button>
        <button id="confirmDeleteButton" class="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Delete</button>
      </div>
    </div>
  </div>
</div>

<script>
let productIdToDelete = null;

function showDeleteModal(productId) {
    productIdToDelete = productId;
    document.getElementById("deleteModal").classList.remove("hidden");
}

function hideDeleteModal() {
    document.getElementById("deleteModal").classList.add("hidden");
    productIdToDelete = null;
}

document.getElementById("confirmDeleteButton").addEventListener("click", async () => {
    if (!productIdToDelete) return;

    try {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        // Match the URL pattern name
        await fetch(`/delete-product/${productIdToDelete}/`, {
            method: "POST",
            headers: { 
                'X-CSRFToken': csrfToken,
                'Accept': 'application/json'
            }
        });

        hideDeleteModal();
        showToast("Product deleted successfully!", "", "success");

        // Refresh product grid
        document.dispatchEvent(new CustomEvent("productDeleted"));
    } catch (err) {
        console.error(err);
        showToast("Failed to delete product", "", "error");
    }
});

</script>
